import{s as i,D as c,g as r}from"./storage-DnL5_qqF.js";chrome.runtime.onInstalled.addListener(async e=>{if(e.reason==="install")console.log("[LexiLens] Extension installed, setting defaults"),await i(c);else if(e.reason==="update"){console.log("[LexiLens] Extension updated to version",chrome.runtime.getManifest().version);const t=await r(),s={...c,...t};await i(s)}});chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"lexilens-read-selection",title:"ðŸ”Š Read with LexiLens",contexts:["selection"]}),chrome.contextMenus.create({id:"lexilens-summarize-selection",title:"ðŸ“ Summarize with LexiLens",contexts:["selection"]})})});const a=e=>{chrome.scripting.executeScript({target:{tabId:e},files:["webgazer.js"],world:"MAIN"},()=>{if(chrome.runtime.lastError){console.error("Failed to inject WebGazer:",JSON.stringify(chrome.runtime.lastError));return}chrome.scripting.executeScript({target:{tabId:e},files:["iris-driver.js"],world:"MAIN"})})};chrome.runtime.onMessage.addListener((e,t,s)=>{var n;e.type==="INJECT_IRIS"&&((n=t.tab)!=null&&n.id)&&a(t.tab.id)});chrome.contextMenus.onClicked.addListener(async(e,t)=>{e.selectionText&&(t!=null&&t.id)&&(e.menuItemId==="lexilens-read-selection"?chrome.tabs.sendMessage(t.id,{type:"READ_TEXT",payload:e.selectionText}):e.menuItemId==="lexilens-summarize-selection"&&chrome.tabs.sendMessage(t.id,{type:"SUMMARIZE_TEXT",payload:e.selectionText}))});chrome.runtime.onMessage.addListener((e,t,s)=>{if(e.type==="GET_SETTINGS")return r().then(n=>{s({success:!0,settings:n})}),!0;if(e.type==="SAVE_SETTINGS")return i(e.payload).then(()=>{s({success:!0})}),!0;if(e.type==="TOGGLE_EXTENSION")return r().then(async n=>{const o={...n,enabled:!n.enabled};await i(o),s({success:!0,enabled:o.enabled})}),!0});console.log("[LexiLens] Background service worker started");
